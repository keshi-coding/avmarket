# Arquivo de Fontes Consolidado

Este arquivo contém todos os códigos relevantes do projeto Django para que possamos revisar, documentar e continuar o desenvolvimento de forma organizada. 

## Última Atualização: 18-01-2025 21:01
## Estrutura do Projeto
estrutura geral das pastas e arquivos:

```
site-relacionamento/
├── manage.py
├── meu_app/
│   ├── migrations/
│   │   ├── 0001_initial.py
│   │   ├── 0002_mensagem.py
│   │   └── __init__.py
│   ├── static/
│   │   ├── css/
│   │   │   ├── bootstrap.min.css
│   │   │   └── styles.css
│   │   ├── js/
│   │   │   └── bootstrap.bundle.min.js
│   │   ├── images/
│   │   │   └── default-profile.webp
│   ├── templates/
│   │   ├── account/
│   │   │   ├── password_reset.html
│   │   │   ├── signup.html
│   │   │   └── verificarion_sent.html
│   │   ├── meu_app/
│   │   │   ├── base.html
│   │   │   ├── editar_perfil.html
│   │   │   ├── home.html
│   │   │   ├── perfil.html
│   │   │   ├── enviar_mensagem.html
│   │   │   ├── listar_usuarios.html
│   │   │   ├── lista_mensagens.html
│   │   │   └── tela_inicial.html
│   ├── views.py
│   ├── models.py
│   ├── forms.py
│   ├── urls.py
│   ├── admin.py
│   ├── apps.py
│   ├── signals.py
│   ├── validators.py
│   └── tests.py
├── site_relacionamento/
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── media/
│   └── profile_pictures/
│       ├── 995334cf347e7572e9f844ccd23d9eb1.jpg
│       ├── paisabem_1.jpeg
│       └── ninja_forex.jpg
├── .gitignore
├── README.md
```

## 1. manage.py
```python
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'site_relacionamento.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

```

## 2. meu_app/models.py
```python
from django.contrib.auth.models import User  # Importa o modelo User, que gerencia usuários no Django.
from django.db import models  # Importa os utilitários para criar modelos no Django.

# Modelo de Perfil para estender as informações do usuário padrão
class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    # Relacionamento um-para-um com o modelo User. Quando o usuário é deletado, o perfil também é.

    bio = models.TextField(blank=True, null=True)
    # Campo opcional para a biografia do usuário.

    location = models.CharField(max_length=100, blank=True, null=True)
    # Campo opcional para armazenar a localização do usuário, com um limite de 100 caracteres.

    profile_picture = models.ImageField(upload_to='profile_pictures/', blank=True, null=True)
    # Campo para upload da foto de perfil do usuário. As imagens são salvas no diretório `media/profile_pictures/`.

    def __str__(self):
        return f'{self.user.username} Profile'
    # Define a representação em string do objeto Profile, exibindo o nome de usuário associado.

# Modelo de Mensagens para armazenar conversas entre usuários
class Mensagem(models.Model):
    remetente = models.ForeignKey(User, on_delete=models.CASCADE, related_name='mensagens_enviadas')
    # Relaciona a mensagem ao remetente. `related_name` permite acessar as mensagens enviadas via `user.mensagens_enviadas`.

    destinatario = models.ForeignKey(User, on_delete=models.CASCADE, related_name='mensagens_recebidas')
    # Relaciona a mensagem ao destinatário. `related_name` permite acessar as mensagens recebidas via `user.mensagens_recebidas`.

    conteudo = models.TextField()
    # Armazena o conteúdo da mensagem.

    timestamp = models.DateTimeField(auto_now_add=True)
    # Registra automaticamente a data e hora em que a mensagem foi criada.

    lido = models.BooleanField(default=False)
    # Indica se a mensagem foi lida pelo destinatário. Por padrão, é definida como `False`.

    def __str__(self):
        return f"Mensagem de {self.remetente} para {self.destinatario} - {self.timestamp}"
    # Define a representação em string do objeto Mensagem, exibindo o remetente, destinatário e data/hora.

```

## 3. meu_app/views.py
```python
from allauth.account.forms import SignupForm
from allauth.account.models import EmailAddress
from django.contrib import messages
from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User
from django.http import JsonResponse
from django.shortcuts import get_object_or_404, render, redirect
from .models import Mensagem, Profile


@login_required
def home(request):
    """
    Exibe a página inicial para usuários logados.
    """
    return render(request, 'meu_app/home.html', {'username': request.user.username})


@login_required
def perfil(request, email=None):
    """
    Exibe o perfil do usuário logado ou de outro usuário.
    """
    user = get_object_or_404(User, email=email) if email else request.user

    return render(request, 'meu_app/perfil.html', {
        'username': user.username,
        'email': user.email,
        'first_name': user.first_name,
        'last_name': user.last_name,
        'profile': user.profile,
    })


@login_required
def editar_perfil(request):
    """
    Permite que o usuário edite seu perfil.
    """
    from .forms import ProfileForm

    profile = request.user.profile
    if request.method == 'POST':
        form = ProfileForm(request.POST, request.FILES, instance=profile)
        if form.is_valid():
            form.save()
            messages.success(request, "Perfil atualizado com sucesso!")
            return redirect('perfil')
    else:
        form = ProfileForm(instance=profile)
    return render(request, 'meu_app/editar_perfil.html', {'form': form})


def tela_inicial(request):
    """
    Exibe a tela inicial para usuários não logados.
    """
    if request.user.is_authenticated:
        return redirect('home')
    return render(request, 'meu_app/tela_inicial.html')


def verificar_email(request):
    """
    Verifica se um e-mail já está cadastrado no banco de dados.
    """
    if request.method == "GET":
        email = request.GET.get('email', None)
        existe = User.objects.filter(email=email).exists() if email else False
        return JsonResponse({'existe': existe})
    return JsonResponse({'existe': False})


def signup_view(request):
    """
    View personalizada para cadastro de usuários.
    """
    if request.method == "POST":
        form = SignupForm(request.POST)
        if form.is_valid():
            user = form.save(request)
            messages.success(request, "Cadastro realizado com sucesso! Um e-mail foi enviado para confirmação.")
            return redirect('tela_inicial')
        else:
            messages.error(request, "Erro ao tentar cadastrar. Verifique os campos e tente novamente.")
    else:
        form = SignupForm()

    return render(request, 'account/signup.html', {'form': form})


@login_required
def lista_mensagens(request):
    """
    Lista as mensagens enviadas e recebidas pelo usuário logado.
    """
    mensagens_enviadas = Mensagem.objects.filter(remetente=request.user).order_by('-timestamp')
    mensagens_recebidas = Mensagem.objects.filter(destinatario=request.user).order_by('-timestamp')

    return render(request, 'meu_app/lista_mensagens.html', {
        'mensagens_enviadas': mensagens_enviadas,
        'mensagens_recebidas': mensagens_recebidas,
    })


@login_required
def listar_usuarios(request):
    """
    Lista todos os perfis de usuários registrados, exceto o usuário logado.
    """
    usuarios = Profile.objects.exclude(user=request.user)
    return render(request, 'meu_app/listar_usuarios.html', {'usuarios': usuarios})


@login_required
def enviar_mensagem(request, email):
    """
    Permite que o usuário logado envie uma mensagem para outro usuário.
    """
    destinatario = get_object_or_404(User, email=email)

    if request.method == 'POST':
        conteudo = request.POST.get('mensagem')
        if conteudo:
            Mensagem.objects.create(remetente=request.user, destinatario=destinatario, conteudo=conteudo)
            messages.success(request, 'Mensagem enviada com sucesso!')
            return redirect('perfil_outro', email=email)

    return render(request, 'meu_app/enviar_mensagem.html', {'destinatario': destinatario})


@login_required
def resend_verification_email(request):
    """
    Reenvia o e-mail de verificação para o usuário.
    """
    try:
        email_address = EmailAddress.objects.get(user=request.user, primary=True)
        if not email_address.verified:
            email_address.send_confirmation(request)
            messages.success(request, "E-mail de verificação reenviado com sucesso!")
        else:
            messages.info(request, "Este e-mail já foi verificado.")
    except EmailAddress.DoesNotExist:
        messages.error(request, "Nenhum e-mail encontrado para este usuário.")

    return redirect('account_email_verification_sent')

```

## 4. meu_app/urls.py
```python
from django.conf import settings  # Importa as configurações do projeto, incluindo DEBUG e URLs de mídia
from django.conf.urls.static import static  # Necessário para servir arquivos estáticos e de mídia em desenvolvimento
from django.contrib import admin  # Importa o painel de administração do Django
from django.urls import path, include  # Ferramentas para criar rotas no Django

from meu_app.views import home, perfil, editar_perfil, tela_inicial, verificar_email, lista_mensagens, listar_usuarios, \
    enviar_mensagem, resend_verification_email

# Importa as views específicas do app 'meu_app'
urlpatterns = [
    path('admin/', admin.site.urls),  # Rota para o painel de administração
    path('accounts/', include('allauth.urls')),  # Inclui as URLs do django-allauth para login/cadastro
    path('', tela_inicial, name='tela_inicial'),  # Rota para a tela inicial
    path('home/', home, name='home'),  # Página inicial após o login
    path('perfil/', perfil, name='perfil'),  # Página de perfil do usuário
    path('perfil/editar/', editar_perfil, name='editar_perfil'),  # Página para editar o perfil do usuário
    path('verificar-email/', verificar_email, name='verificar_email'),  # Verificação se o e-mail existe no sistema
    path('mensagens/', lista_mensagens, name='lista_mensagens'),  # Rota para exibir mensagens enviadas e recebidas
    path('usuarios/', listar_usuarios, name='listar_usuarios'), # Rota para listar usuarios
    path('perfil/<str:email>/', perfil, name="perfil_outro"),
    path('mensagem/enviar/<str:email>/', enviar_mensagem, name='enviar_mensagem'),
    path('accounts/resend-verification-email/', resend_verification_email, name='account_resend_email'),
]

# Adiciona rotas para servir arquivos de mídia no ambiente de desenvolvimento
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

```

## 5. meu_app/forms.py
```python
from django import forms
from .models import Profile
from allauth.account.forms import SignupForm
from django.core.exceptions import ValidationError
from django.contrib.auth.models import User

# Formulário para editar o perfil do usuário
class ProfileForm(forms.ModelForm):
    class Meta:
        model = Profile  # Modelo associado ao formulário
        fields = ['bio', 'location', 'profile_picture']  # Campos disponíveis para edição
        labels = {  # Rótulos personalizados para os campos
            'bio': 'Biografia',
            'location': 'Localização',
            'profile_picture': 'Foto de Perfil',
        }

# Formulário personalizado para cadastro
class CustomSignupForm(SignupForm):
    def __init__(self, *args, **kwargs):
        # Inicializa o formulário padrão do Allauth
        super().__init__(*args, **kwargs)
        # Esconde o campo de username no formulário (não será visível para o usuário)
        self.fields['username'].widget = forms.HiddenInput()
        # Define um valor temporário para o username, necessário durante o cadastro
        self.fields['username'].initial = 'temp_username'

    def clean_email(self):
        """
        Verifica se o e-mail já existe no banco de dados.
        Se existir, levanta um erro de validação.
        """
        email = self.cleaned_data['email']  # Obtém o e-mail informado pelo usuário
        if User.objects.filter(email=email).exists():
            raise ValidationError("Este e-mail já está cadastrado. Por favor, use outro.")
        return email  # Retorna o e-mail validado

    def save(self, request):
        """
        Sobrescreve o método save para personalizar o processo de salvamento do usuário.
        - Define o username como a parte antes do "@" no e-mail.
        """
        user = super().save(request)  # Salva o usuário com os dados padrão do Allauth
        # Define o username como a parte antes do "@" no e-mail
        user.username = user.email.split('@')[0]
        user.save()  # Salva o usuário novamente com o username atualizado
        return user  # Retorna o objeto do usuário

```

## 6. Templates

### 6.1 meu_app/templates/meu_app/base.html
```html
 {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Meu Site{% endblock %}</title>
    <!-- Link para o Bootstrap local -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<header>
    {% if not hide_menu %}
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Meu Site</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/perfil/">Perfil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'lista_mensagens' %}">Mensagens</a> <!-- Link para mensagens -->
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'account_logout' %}">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    {% endif %}
</header>
<main class="container mt-4">
    {% block content %}{% endblock %}
</main>
<footer class="text-center mt-4">
    <p>&copy; 2025 vk.solutions</p>
</footer>
<!-- Script do Bootstrap local -->
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
```

### 6.2 meu_app/templates/meu_app/perfil.html
```html
{% extends "meu_app/base.html" %}

{% block title %}Perfil do Usuário{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-center">Perfil de {{ username }}</h1>
    <div class="card mx-auto" style="max-width: 600px;">
        <div class="card-body">
            <h5 class="card-title">Informações do Usuário</h5>
            <p><strong>Nome:</strong> {{ first_name }} {{ last_name }}</p>
            <p><strong>E-mail:</strong> {{ email }}</p>
            <p><strong>Bio:</strong> {{ profile.bio|default_if_none:"Não informado" }}</p>
            <p><strong>Localização:</strong> {{ profile.location|default_if_none:"Não informado" }}</p>
        </div>
        <div class="card-footer text-center">
            <p><strong>Foto de Perfil:</strong></p>
            {% if profile.profile_picture %}
                <img src="{{ profile.profile_picture.url }}" alt="Foto de Perfil" class="img-thumbnail" width="150">
            {% else %}
                <p>Sem foto de perfil</p>
            {% endif %}

            <!-- Botão Enviar Mensagem -->
            {% if request.user.email != email %}
            <a href="{% url 'enviar_mensagem' email %}" class="btn btn-primary mt-3">Enviar Mensagem</a>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}

```
### 6.3 meu_app/templates/meu_app/tela_inicial.html
```html
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bem-vindo ao Meu Site{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
</head>
<body>
    {% block content %}
    {% url 'account_signup' as signup_url %}
    <div class="container text-center mt-5">
        <h1>Bem-vindo ao Site de Relacionamento LGBT</h1>
        <p class="lead mt-3">O Amor é para todos!.</p>

        <!-- Formulário de Login -->
        <div class="mt-4">
            <form method="post" action="{% url 'account_login' %}" class="text-start mx-auto" style="max-width: 400px;">
                {% csrf_token %}
                <!-- Campo de E-mail -->
                <div class="mb-3">
                    <label for="id_email" class="form-label">E-mail</label>
                    <input type="text" id="id_email" name="login" class="form-control" placeholder="Digite seu e-mail" required>
                    <small id="email_feedback" class="form-text text-danger"></small>
                </div>
                <!-- Campo de Senha -->
                <div class="mb-3">
                    <label for="id_password" class="form-label">Senha</label>
                    <input type="password" id="id_password" name="password" class="form-control" placeholder="Digite sua senha" required>
                </div>
                <!-- Botão de Login -->
                <button type="submit" class="btn btn-primary btn-lg w-100">Entrar</button>
            </form>
        </div>

        <!-- Link para Cadastro -->
        <div class="mt-3">
            <p><a href="{% url 'account_reset_password' %}" class="d-block text-center mb-2">Esqueceu sua senha?</a></p>
            <p>Não tem uma conta? <a href="{% url 'account_signup' %}">Cadastre-se</a></p>
        </div>
    </div>
    {% endblock %}

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const emailField = document.querySelector("#id_email");
            const emailFeedback = document.querySelector("#email_feedback");
            const signupUrl = "{% url 'account_signup' %}"; // URL calculada pelo servidor

            emailField.addEventListener("blur", function () {
                const email = emailField.value.trim();

                if (email.length > 3) {
                    fetch(`/verificar-email/?email=${encodeURIComponent(email)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.existe) {
                                emailFeedback.innerHTML = `E-mail não encontrado. Você pode se cadastrar clicando <a href="${signupUrl}">AQUI</a>.`;
                            } else {
                                emailFeedback.textContent = ""; // Limpa a mensagem se o e-mail existir
                            }
                        })
                        .catch(error => {
                            console.error("Erro ao verificar o e-mail:", error);
                            emailFeedback.textContent = "Erro ao verificar o e-mail. Tente novamente mais tarde.";
                        });
                } else {
                    emailFeedback.textContent = "";
                }
            });
        });
    </script>
</body>
</html>

```
### 6.4 meu_app/templates/meu_app/listar_usuarios.html
``` html
{% extends 'meu_app/base.html' %}

{% block content %}
<h2 class="text-center">Usuários Registrados</h2>

<div class="row mt-4">
    {% for usuario in usuarios %}
    <div class="col-md-4 mb-4">
        <div class="user-card">
            <!-- Exibe a foto de perfil do usuário -->
            {% if usuario.profile_picture %}
            <img src="{{ usuario.profile_picture.url }}" class="img-thumbnail" alt="Foto de {{ usuario.user.username }}">
            {% else %}
            <img src="/static/images/default-profile.webp" class="img-thumbnail" alt="Foto padrão">
            {% endif %}

            <div class="user-details">
                <!-- Exibe o nome e localização -->
                <h5 class="user-name">{{ usuario.user.first_name }} {{ usuario.user.last_name }}</h5>
                <p class="user-location">{{ usuario.location }}</p>
                <a href="{% url 'perfil_outro' usuario.user.email %}" class="btn btn-primary">Ver Perfil</a>
            </div>
        </div>
    </div>
    {% empty %}
    <p class="text-center">Nenhum usuário encontrado.</p>
    {% endfor %}
</div>
{% endblock %}
```
### 6.5 meu_app/templates/meu_app/home.html
```html
{% extends "meu_app/base.html" %}

{% block title %}Bem-vindo!{% endblock %}

{% block content %}

<div class="text-center mt-5">
    <h1>Bem-vindo, {{ username }}!</h1>
    <p>Você está logado com sucesso.</p>
</div>
{% endblock %}
```
### 6.6 meu_app/templates/meu_app/editar_perfil.html
```html
{% extends "meu_app/base.html" %}

{% block title %}Editar Perfil{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-center">Editar Perfil</h1>
    <div class="card mx-auto" style="max-width: 600px;">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                {% csrf_token %}
                <div class="mb-3">
                    {{ form.as_p }} <!-- Renderiza os campos do formulário de forma vertical -->
                </div>
                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    <a href="{% url 'perfil' %}" class="btn btn-secondary">Voltar</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
```
### 6.7 meu_app/templates/account/signup.html
```html
{% extends "meu_app/base.html" %}

{% block title %}Cadastre-se{% endblock %}

{% block content %}
<div class="container text-center mt-5">
    <h1>Crie sua Conta</h1>
    <p class="lead mt-3">Já tem uma conta? <a href="{% url 'tela_inicial' %}">Faça login aqui</a>.</p>

    {% if form.errors %}
    <div class="alert alert-danger mt-3">
        <strong>Erros encontrados:</strong>
        <ul>
            {% for field, errors in form.errors.items %}
            <li>{{ field|capfirst }}: {{ errors|join:", " }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}


    <!-- Mensagem pós-cadastro (caso exista) -->
    {% if messages %}
        <div class="alert alert-success mt-4">
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        </div>
    {% endif %}

    <!-- Formulário de Cadastro -->
    <div class="mt-4">
        <form method="post" action="{% url 'account_signup' %}" class="text-start mx-auto" style="max-width: 400px;">
            {% csrf_token %}

            <!-- Campo: Nome de Usuário (escondido) -->
            <input type="hidden" id="id_username" name="username" value="default_username">

            <!-- Instrução sobre confirmação de e-mail -->
            <div class="alert alert-info" style="background-color: #f0f8ff; color: #004085; border-color: #cce5ff;">
                <strong>Atenção:</strong> Após preencher seu e-mail, você precisará digitá-lo novamente para confirmação. Enviaremos um e-mail para validar sua conta. Certifique-se de digitar corretamente!
            </div>

            <!-- Campo: E-mail -->
            <div class="mb-3">
                <label for="id_email" class="form-label">E-mail</label>
                <input type="email" id="id_email" name="email" class="form-control" placeholder="Digite seu e-mail" required>
                <small id="email_feedback" class="form-text text-danger"></small>
            </div>

            <!-- Campo: Confirmar E-mail -->
            <div class="mb-3">
                <label for="id_confirm_email" class="form-label">Confirme seu E-mail</label>
                <input type="email" id="id_confirm_email" name="confirm_email" class="form-control" placeholder="Confirme seu e-mail" required>
                <small id="confirm_email_feedback" class="form-text text-danger"></small>
            </div>

            <!-- Instrução sobre a senha -->
            <div class="mb-3">
                <div class="alert alert-info" style="background-color: #f0f8ff; color: #004085; border-color: #cce5ff;">
                    <strong>Instruções:</strong> Sua senha deve ter:
                    <ul class="text-start" style="margin-left: 1rem;">
                        <li>No mínimo 8 caracteres.</li>
                        <li>Pelo menos uma letra.</li>
                        <li>Pelo menos um número.</li>
                    </ul>
                </div>
            </div>

            <!-- Campo: Senha -->
            <div class="mb-3">
                <label for="id_password1" class="form-label">Senha</label>
                <input type="password" id="id_password1" name="password1" class="form-control" placeholder="Digite sua senha" required>
                <small id="password_feedback" class="form-text text-danger"></small>
            </div>

            <!-- Campo: Confirmar Senha -->
            <div class="mb-3">
                <label for="id_password2" class="form-label">Confirme a Senha</label>
                <input type="password" id="id_password2" name="password2" class="form-control" placeholder="Confirme sua senha" required>
                <small id="confirm_password_feedback" class="form-text text-danger"></small>
            </div>

            <!-- Botão de Cadastro -->
            <button type="submit" class="btn btn-primary btn-lg w-100">Cadastrar</button>
        </form>
    </div>
</div>

<!-- Script para validação dinâmica -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const emailField = document.querySelector("#id_email");
        const confirmEmailField = document.querySelector("#id_confirm_email");
        const emailFeedback = document.querySelector("#email_feedback");
        const confirmEmailFeedback = document.querySelector("#confirm_email_feedback");
        const passwordField = document.querySelector("#id_password1");
        const confirmPasswordField = document.querySelector("#id_password2");
        const passwordFeedback = document.querySelector("#password_feedback");
        const confirmPasswordFeedback = document.querySelector("#confirm_password_feedback");

        // Função para validar a correspondência do e-mail
        function validateEmails() {
            const email = emailField.value.trim();
            const confirmEmail = confirmEmailField.value.trim();

            if (email && confirmEmail && email !== confirmEmail) {
                confirmEmailFeedback.textContent = "Os e-mails não correspondem.";
            } else {
                confirmEmailFeedback.textContent = "";
            }
        }

        // Função para validar o formato da senha
        function validatePassword(password) {
            const errors = [];

            if (password.length < 8) {
                errors.push("A senha deve ter pelo menos 8 caracteres.");
            }
            if (!/[a-zA-Z]/.test(password)) {
                errors.push("A senha deve conter pelo menos uma letra.");
            }
            if (!/\d/.test(password)) {
                errors.push("A senha deve conter pelo menos um número.");
            }

            return errors;
        }

        // Função para validar a correspondência das senhas
        function validatePasswords() {
            const password = passwordField.value.trim();
            const confirmPassword = confirmPasswordField.value.trim();

            // Mensagens de erro sobre o formato da senha
            const errors = validatePassword(password);
            if (errors.length > 0) {
                passwordFeedback.innerHTML = errors.join("<br>");
            } else {
                passwordFeedback.innerHTML = "";
            }

            // Mensagens sobre a correspondência da senha
            if (password && confirmPassword && password !== confirmPassword) {
                confirmPasswordFeedback.textContent = "As senhas não correspondem.";
            } else {
                confirmPasswordFeedback.textContent = "";
            }
        }

        // Eventos "input" para validação dinâmica
        emailField.addEventListener("input", validateEmails);
        confirmEmailField.addEventListener("input", validateEmails);
        passwordField.addEventListener("input", validatePasswords);
        confirmPasswordField.addEventListener("input", validatePasswords);
    });
</script>
{% endblock %}

```
### 6.8 meu_app/templates/account/verification_sent.html
```html
{% extends "meu_app/base.html" %}

{% block title %}E-mail de Confirmação Enviado{% endblock %}

{% block content %}
<html lang="pt-br">
<head>
    <meta charset="UTF-8"> <!-- Define a codificação do texto -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsividade para dispositivos -->
    <title>E-mail de Confirmação</title> <!-- Título exibido na aba do navegador -->
</head>
<body>
    <div class="container text-center mt-5">
        <!-- Título principal -->
        <h1>Verifique Seu E-mail</h1>

        <!-- Mensagem de instrução -->
        <p class="lead mt-3">
            Um e-mail de confirmação foi enviado para o endereço cadastrado.
            Siga as instruções no e-mail para finalizar o cadastro.
        </p>

        <!-- Instrução adicional para o caso de o e-mail não ser encontrado -->
        <p>
            Caso não encontre o e-mail na sua caixa de entrada, verifique a pasta de spam ou lixeira.
        </p>

        <!-- Link para reenviar o e-mail -->
        <p class="mt-4">
            <strong>Não recebeu o e-mail?</strong> <br>
            <a href="{% url 'account_resend_email' %}" class="btn btn-link">Clique aqui para reenviar</a>
        </p>
    </div>
</body>
</html>
{% endblock %}

```
### 6.9 meu_app/templates/account/password_reset.html
```html
{% extends "meu_app/base.html" %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow">
        <div class="card-header bg-primary text-white text-center">
          <h4>Recuperar Senha</h4>
        </div>
        <div class="card-body">
          <p class="text-center">
            Esqueceu sua senha? Insira seu e-mail abaixo e enviaremos um link para redefini-la.
          </p>
          <form method="post">
            {% csrf_token %}
            <div class="form-group mb-4">
              <input type="email" id="id_email" name="email" class="form-control form-control-lg" placeholder="Digite seu e-mail">
            </div>
            <button type="submit" class="btn btn-primary btn-lg w-100">
              Redefinir Minha Senha
            </button>
          </form>
          <p class="text-center mt-3 text-muted">
            Se tiver algum problema, entre em contato conosco.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
```

## 7. site_relacionamento/settings.py
```python
"""
Django settings for site_relacionamento project.

Generated by 'django-admin startproject' using Django 5.1.4.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.1/ref/settings/
"""

import ssl
import smtplib
import os

from pathlib import Path

from django.conf.global_settings import EMAIL_BACKEND

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.1/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-ul02u%=kbi+@m66u%l)=v1=@stg=lnf-cp3^%5$q^(886p7zt2'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []

# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'meu_app',

    # django-allauth
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
]

# django-allauth requer a identificação de qual site
SITE_ID = 1

# Redirecionamento após login
LOGIN_REDIRECT_URL = '/'

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'allauth.account.middleware.AccountMiddleware',
]

ROOT_URLCONF = 'site_relacionamento.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                # Outros context processors existentes
                'site_relacionamento.context_processors.hide_menu',
            ],
        },
    },
]

WSGI_APPLICATION = 'site_relacionamento.wsgi.application'

# Database
# https://docs.djangoproject.com/en/5.1/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'relacionamento',
        'USER': 'postgres',
        'PASSWORD': 'SDf872D553#41#%^@@#Dz',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}

# Password validation
# https://docs.djangoproject.com/en/5.1/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'meu_app.validators.CustomPasswordValidator',  # Nome ajustado do validador
    },
]

# Internationalization
# https://docs.djangoproject.com/en/5.1/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True

# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.1/howto/static-files/

STATIC_URL = 'static/'

# Diretórios adicionais para arquivos estáticos (CSS, JS, imagens, etc.)
STATICFILES_DIRS = [
    BASE_DIR / 'meu_app/static',  # Configura a pasta estática do app
]

# Arquivos de mídia (imagens, arquivos enviados pelo usuário)
MEDIA_URL = '/media/'  # URL para acessar arquivos de mídia
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')  # Diretório onde os arquivos de mídia serão armazenados

# Default primary key field type
# https://docs.djangoproject.com/en/5.1/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# Configuração de e-mails
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'sandbox.smtp.mailtrap.io'
EMAIL_PORT = 2525
EMAIL_HOST_USER = '535a321792feb2'
EMAIL_HOST_PASSWORD = 'dd91d588ab2762'
EMAIL_USE_TLS = True
EMAIL_USE_SSL = False
DEFAULT_FROM_EMAIL = 'noreply@seusite.com'



# Autenticação do Django Allauth - usar apenas o email como identificador
ACCOUNT_EMAIL_VERIFICATION = "mandatory"  # Verificação de e-mail
ACCOUNT_USERNAME_REQUIRED = False  # Login por nome de usuário
ACCOUNT_AUTHENTICATION_METHOD = "email"  # Autenticação por nome de usuário
ACCOUNT_EMAIL_REQUIRED = True  # E-mail obrigatório
ACCOUNT_SIGNUP_REDIRECT_URL = "/"  # Redirecionamento após cadastro
ACCOUNT_UNIQUE_EMAIL = True # Exige e-mail unico
# Número de tentativas antes do bloqueio
ACCOUNT_LOGIN_ATTEMPTS_LIMIT = 100
ACCOUNT_LOGIN_ATTEMPTS_TIMEOUT = 1

AUTHENTICATION_BACKENDS = [
    'django.contrib.auth.backends.ModelBackend',  # Backend padrão do Django
    'allauth.account.auth_backends.AuthenticationBackend',  # Backend do Allauth
]
```

## 8. site_relacionamento/urls.py
```python
from django.conf import settings  # Importa as configurações do projeto, incluindo DEBUG e URLs de mídia
from django.conf.urls.static import static  # Necessário para servir arquivos estáticos e de mídia em desenvolvimento
from django.contrib import admin  # Importa o painel de administração do Django
from django.urls import path, include  # Ferramentas para criar rotas no Django

from meu_app.views import home, perfil, editar_perfil, tela_inicial, verificar_email, lista_mensagens, listar_usuarios, \
    enviar_mensagem, resend_verification_email

# Importa as views específicas do app 'meu_app'
urlpatterns = [
    path('admin/', admin.site.urls),  # Rota para o painel de administração
    path('accounts/', include('allauth.urls')),  # Inclui as URLs do django-allauth para login/cadastro
    path('', tela_inicial, name='tela_inicial'),  # Rota para a tela inicial
    path('home/', home, name='home'),  # Página inicial após o login
    path('perfil/', perfil, name='perfil'),  # Página de perfil do usuário
    path('perfil/editar/', editar_perfil, name='editar_perfil'),  # Página para editar o perfil do usuário
    path('verificar-email/', verificar_email, name='verificar_email'),  # Verificação se o e-mail existe no sistema
    path('mensagens/', lista_mensagens, name='lista_mensagens'),  # Rota para exibir mensagens enviadas e recebidas
    path('usuarios/', listar_usuarios, name='listar_usuarios'), # Rota para listar usuarios
    path('perfil/<str:email>/', perfil, name="perfil_outro"),
    path('mensagem/enviar/<str:email>/', enviar_mensagem, name='enviar_mensagem'),
    path('accounts/resend-verification-email/', resend_verification_email, name='account_resend_email'),
]

# Adiciona rotas para servir arquivos de mídia no ambiente de desenvolvimento
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

## 9. meu_app/validators.py
```python
import re
from django.core.exceptions import ValidationError
from django.utils.translation import gettext as _

class CustomPasswordValidator:
    def validate(self, password, user=None):
        # Verifica se a senha tem pelo menos 8 caracteres
        if len(password) < 8:
            raise ValidationError(
                _("A senha deve ter pelo menos 8 caracteres."),
                code='password_too_short',
            )

        # Verifica se a senha contém pelo menos uma letra (ocidental)
        if not any(char.isalpha() for char in password):
            raise ValidationError(
                _("A senha deve conter pelo menos uma letra."),
                code='password_no_letter',
            )

        # Verifica se a senha contém pelo menos um número
        if not any(char.isdigit() for char in password):
            raise ValidationError(
                _("A senha deve conter pelo menos um número."),
                code='password_no_number',
            )

    def get_help_text(self):
        return _(
            "Sua senha deve ter pelo menos 8 caracteres, incluindo pelo menos uma letra e um número."
        )
```